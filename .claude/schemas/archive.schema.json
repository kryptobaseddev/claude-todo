{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "claude-todo-archive-schema-v2.1",
  "title": "CLAUDE-TODO Archive Schema",
  "description": "Storage for completed tasks. Archived tasks are IMMUTABLE - never modify after archival.",
  "type": "object",
  "required": ["version", "project", "archivedTasks", "_meta"],
  "additionalProperties": false,

  "properties": {
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "description": "Schema version (semver). Must match todo.json version."
    },
    "project": {
      "type": "string",
      "description": "Project identifier. Must match todo.json project."
    },
    "_meta": {
      "type": "object",
      "required": ["totalArchived", "lastArchived"],
      "additionalProperties": false,
      "properties": {
        "totalArchived": {
          "type": "integer",
          "minimum": 0,
          "description": "Total count of archived tasks."
        },
        "lastArchived": {
          "type": ["string", "null"],
          "format": "date-time",
          "description": "Timestamp of most recent archival operation."
        },
        "oldestTask": {
          "type": ["string", "null"],
          "format": "date-time",
          "description": "Completion date of oldest archived task."
        },
        "newestTask": {
          "type": ["string", "null"],
          "format": "date-time",
          "description": "Completion date of newest archived task."
        }
      }
    },
    "archivedTasks": {
      "type": "array",
      "description": "Completed tasks moved from todo.json. IMMUTABLE after archival.",
      "items": { "$ref": "#/definitions/archivedTask" }
    },
    "statistics": {
      "type": "object",
      "description": "Computed statistics. Regenerate on archive operations.",
      "properties": {
        "byPhase": {
          "type": "object",
          "description": "Task counts by phase.",
          "patternProperties": {
            "^[a-z][a-z0-9-]*$": { "type": "integer" }
          }
        },
        "byPriority": {
          "type": "object",
          "description": "Task counts by priority.",
          "properties": {
            "critical": { "type": "integer" },
            "high": { "type": "integer" },
            "medium": { "type": "integer" },
            "low": { "type": "integer" }
          }
        },
        "byLabel": {
          "type": "object",
          "description": "Task counts by label.",
          "patternProperties": {
            "^[a-z][a-z0-9-]*$": { "type": "integer" }
          }
        },
        "averageCycleTime": {
          "type": ["number", "null"],
          "description": "Average days from creation to completion."
        }
      }
    }
  },

  "definitions": {
    "archivedTask": {
      "type": "object",
      "required": ["id", "title", "status", "priority", "createdAt", "completedAt", "_archive"],
      "additionalProperties": false,
      "description": "Archived task with original data plus archive metadata.",
      "properties": {
        "id": { "type": "string", "pattern": "^T\\d{3,}$" },
        "title": { "type": "string" },
        "status": { "type": "string", "const": "done" },
        "priority": { "type": "string", "enum": ["critical", "high", "medium", "low"] },
        "phase": { "type": "string" },
        "description": { "type": "string" },
        "files": { "type": "array", "items": { "type": "string" } },
        "acceptance": { "type": "array", "items": { "type": "string" } },
        "depends": { "type": "array", "items": { "type": "string" } },
        "notes": { "type": "array", "items": { "type": "string" } },
        "labels": { "type": "array", "items": { "type": "string" } },
        "createdAt": { "type": "string", "format": "date-time" },
        "completedAt": { "type": "string", "format": "date-time" },
        "_archive": {
          "type": "object",
          "required": ["archivedAt", "reason"],
          "additionalProperties": false,
          "description": "Archive metadata added during archival.",
          "properties": {
            "archivedAt": {
              "type": "string",
              "format": "date-time",
              "description": "When this task was archived."
            },
            "reason": {
              "type": "string",
              "enum": ["auto", "manual", "stale"],
              "description": "auto=config rules, manual=user request, stale=exceeded retention."
            },
            "sessionId": {
              "type": "string",
              "description": "Session that performed the archival."
            },
            "cycleTimeDays": {
              "type": "number",
              "description": "Days from creation to completion."
            }
          }
        }
      }
    }
  }
}
